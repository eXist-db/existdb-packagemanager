<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="bower_components/iron-pages/iron-pages.html">
<link rel="import" href="bower_components/paper-styles/color.html">
<link rel="import" href="bower_components/paper-styles/typography.html">
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/iron-icon/iron-icon.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/vaadin-upload/vaadin-upload.html">
<link rel="import" href="bower_components/bottom-nav/bottom-nav.html">

<link rel="import" href="existdb-package-descriptor.html">

<!--
`existdb-packagemanager`
a web component implementing eXistdb packagemanager

@demo demo/doc.html
-->

<dom-module id="existdb-packagemanager">
    <template>
        <style>
            :host {
                display: block;


                --paper-tabs-selection-bar-color: var(--paper-blue-700);
                @apply(--paper-font-common-base);
                position: relative;
                background: whitesmoke;
                padding:0;
                margin: 0;
                width: 100%;
                height: 100%;

                --vaadin-upload-button-add:{
                    background: var(--paper-blue-700);
                }
            }

            app-header{
             background: white;
                border-bottom:1px solid #dedede;
            }

            #packageList{
            }
            ::content ul{
                list-style: none;
                padding:0;
            }

            ::content existdb-package-descriptor{
                background: white;
                margin:10px 0;
                border:thin solid #dedede;

            }

            ::content ul li table{
                display: none;
            }

            ::content .packageIconArea{
                /*display: inline-flex;*/
            }
            ::content .shortTitle {
                display: flex;
                flex-direction:column;

                flex-grow: 3;
            }

            ::content.appIcon{
                max-width:100px;
                height:40px;
            }

            paper-fab{
                position: fixed;
                z-index: 10;
                bottom: 20px;
                right: 20px;
                --paper-fab-background:var(--paper-blue-700);
            }
            iron-icon{
                margin-right:10px;
                --iron-icon-fill-color:var(--paper-blue-700);
            }
            bottom-nav{
                background: var(--paper-blue-50);
            }

        </style>
        <iron-ajax id="loadPackages"
                   verbose with-credentials
                   method="get" handle-as="text"
                   on-response="handleItems"
                   url="/exist/apps/packagemanager/packages/?format=manager&type=local"
                   auto></iron-ajax>

        <app-header-layout>
            <app-header condenses>
                <app-toolbar>
                    <iron-icon icon="apps"></iron-icon><div>Package Manager</div>
                </app-toolbar>
                <paper-tabs selected="{{selected}}" fixed>
                    <paper-tab>All</paper-tab>
                    <paper-tab>Installed</paper-tab>
                    <paper-tab>Available</paper-tab>
                </paper-tabs>
            </app-header>

            <div id="packageList"></div>

            <bottom-nav id="bottom" fixed>
                <vaadin-upload accept=".xar">
                    <div class="drop-label">
                        <iron-icon icon="description"></iron-icon>
                        DROPZONE - put your package(s) here.
                    </div>
                </vaadin-upload>
            </bottom-nav>
        </app-header-layout>

    </template>

    <script>
        Polymer({

            is: 'existdb-packagemanager',

            properties: {
                url: String,
                notify: true,
                reflectToAttribute: true
            },

            attached: function () {
                this.selected = 0;
                this.$.bottom.threshold=200;
            },

            handleItems: function (data) {
                this.$.packageList.innerHTML = this.$.loadPackages.lastResponse
            },

            showUpload: function (e) {
                this.$.upload.open();
            }

        });
    </script>
</dom-module>
